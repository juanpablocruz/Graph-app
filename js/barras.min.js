"use strict";var barras=1;var fuente_value="Cores";if(localStorage.fuente){fuente_value=localStorage.fuente;}var unidad_value="Miles de t";if(localStorage.unidad){unidad_value=localStorage.unidad;}var barras_mode="compuesto";if(localStorage.barras_mode){barras_mode=localStorage.barras_mode;}_.prototype.bars=function(a){var b=this.id;_().canvas(this.e[0],function(){this.data_content=document.querySelectorAll("#graph-data")[0];this.canvas=document.querySelectorAll(b+" canvas")[0];this.printLabels=true;if(localStorage.drawLabels){this.printLabels=localStorage.drawLabels;}this.destacado=false;if(localStorage.destacado_bars){this.destacado=localStorage.destacado_bars;}else{localStorage.destacado_bars=this.destacado;}this.data=a.data;this.colores_grupos=[];var g=0,e=0;for(var c=0;c<Object.keys(this.data[0]).length;c++){var f=Object.keys(this.data[0])[c];if(barras_mode=="compuesto"){f=this.data[0][Object.keys(this.data[0])[c]];}var d={grupo:f,color:colores_barras[c%colores_barras.length].hex};this.colores_grupos.push(d);}if(!localStorage.coloresBarras){localStorage.coloresBarras=JSON.stringify(this.colores_grupos);}else{this.colores_grupos=JSON.parse(localStorage.coloresBarras);}this.addBarTools(a.data);this.drawBar(this.canvas,a.data);$("#groups-ul").sortable({items:".data-list-li-holder",handle:".data-list-element"});});};_.prototype.bars_type_menu=function(){var a=Array.prototype.slice.call(this.e);var c=document.createElement("LI");c.innerHTML="Gráfico Compuesto<div class='icon-bars2 icono' >";c.setAttribute("id","bars_compuesto");c.setAttribute("tipo","Compuesto");var b=document.createElement("LI");b.innerHTML="Gráfico Columnas<div class='icon-bars icono'></div>";b.setAttribute("id","bars_cols");b.setAttribute("tipo","Columnas");(a).forEach(function(d){d.innerHTML="";d.appendChild(c);d.appendChild(b);});return this;};_.prototype.addBarTools=function(F){var c=document.querySelectorAll("menu")[0];c.innerHTML="";var k=document.querySelectorAll("#graph-data")[0];k.innerHTML="";var D=document.createDocumentFragment();var h=document.createElement("DIV");h.setAttribute("id","data-container");var y=document.createElement("DIV");y.className="data-options";var e=document.createElement("DIV");e.className="data-options";e.setAttribute("id","options-bars");if(barras_mode!="cols"){var v=document.createElement("input");v.type="checkbox";v.setAttribute("id","dibujar-check");var B=document.createElement("label");B.setAttribute("for","dibujar-check");B.setAttribute("class","label-dibujar-check");B.innerHTML="Dibujar Etiquetas";v.checked=false;if(this.printLabels==="true"){v.checked=true;}$(v).on("change",{destc:this.destacado},this.draw_bars_func);var E=document.createElement("DIV");}var s=document.createElement("DIV");s.innerHTML="<span>Fuente: </span>";var g=document.createElement("INPUT");g.type="text";g.setAttribute("id","fuente_input");g.setAttribute("value",fuente_value);var n=document.createElement("DIV");n.innerHTML="<span>Unidad: </span>";var w=document.createElement("INPUT");w.type="text";w.setAttribute("id","unidades_input");w.setAttribute("value",unidad_value);s.appendChild(g);n.appendChild(w);e.appendChild(s);e.appendChild(n);if(barras_mode!="cols"){var m=document.createElement("DIV");var b=document.createElement("input");b.type="checkbox";b.setAttribute("id","destacar_check");var a=document.createElement("label");a.setAttribute("for","destacar_check");a.setAttribute("class","label-dest-check");a.innerHTML="Destacar Sección";a.checked=false;if(this.destacado==="true"){b.checked=true;}m.appendChild(b);m.appendChild(a);e.appendChild(m);$(b).on("change",{destc:this.destacado},this.draw_bars_func);E.appendChild(v);E.appendChild(B);e.appendChild(E);}var r=document.createElement("UL");r.setAttribute("id","groups-ul");var C=Object.keys(F[0]);if(localStorage.ordenacion){C=JSON.parse(localStorage.ordenacion);}for(var x=0;x<C.length;x++){var o=document.createElement("li");var t=document.createElement("DIV");if(barras_mode=="cols"||x>0){t.className="data-list-element-holder";t.innerHTML="<div contenteditable='true'>"+C[x]+"</div>";var l=(barras_mode=="cols")?x:x-1;clinpt(t).input(this.colores_grupos[l]["color"]);$(o).append("<div class='remove-list-item'></div>");o.className="data-list-li-holder";}else{t.innerHTML="<div contenteditable='true'>"+C[x]+"</div>";$(o).append("<div></div>");o.className="data-list-li-year";}o.appendChild(t);var q=document.createElement("ul");for(var A=0;A<F.length;A++){var p=document.createElement("LI");var d=document.createElement("DIV");d.setAttribute("contenteditable","true");d.innerHTML=F[A][C[x]];p.appendChild(d);q.appendChild(p);}o.appendChild(q);r.appendChild(o);}var z=document.createElement("BUTTON");z.innerHTML="Dibujar<div class='icon-pencil icono'></div> ";z.className="draw_button";$(z).on("click",{destc:this.destacado},this.draw_bars_func);var u=document.createElement("BUTTON");u.innerHTML="Reordenar<div class='icon-rearrange icono'></div> ";u.className="rearrange-button";y.appendChild(r);h.appendChild(y);h.appendChild(e);D.appendChild(h);D.appendChild(z);D.appendChild(u);k.appendChild(D);};_.prototype.drawBar=function(a,b){this.ctx=a.getContext("2d");this.data=b;var c=this.getMaxColumn();this.createBarsVerticalAxis(c,6,"barras");this.createBarsHorizontalAxis(c);clinpt().loadFunctions();};_.prototype.getMaxColumn=function(){var b=0;if(barras_mode!="cols"){for(var f=0;f<this.data.length;f++){var e=0;for(var c=1;c<Object.keys(this.data[0]).length;c++){if(!isNaN(this.data[f][Object.keys(this.data[f])[c]])){e+=this.data[f][Object.keys(this.data[f])[c]];}}if(e>b){b=e;}}}else{for(var f=0;f<Object.keys(this.data[0]).length;f++){var e=0;for(var c=0;c<this.data.length;c++){if(!isNaN(this.data[c][Object.keys(this.data[c])[f]])){e+=this.data[c][Object.keys(this.data[c])[f]];}}if(e>b){b=e;}}}var a=Math.round(b).toString().length;var d=Math.pow(10,a-1);var g=parseInt(b/d)+1;var b=g*d;return b;};_.prototype.drawBarra=function(p,k,f,l,r,n,o,c,g,e,d){if((k>0||barras_mode=="cols")&&!isNaN(this.data[f][g[k]])){if(barras_mode!="cols"){e=1;var q=(((this.data[f][g[k]]*100)/this.ceil)*l/100);}else{e=0;var q=(((this.data[f][g[k]]*100)/p)*l/100);}var b=(this.destacado=="true")?colores_alpha[(k-e)%colores_alpha.length].hex:this.colores_grupos[(k-e)%this.colores_grupos.length]["color"];var a=new Kinetic.Shape({drawFunc:function(h){h.beginPath();h.rect(30+((o+c)*(f+d)),r,o,-q);h.closePath();h.fillStrokeShape(this);},stroke:"rgba(0,0,0,0)",strokeWidth:0,fill:b});n.add(a);}};_.prototype.createBarsHorizontalAxis=function(p){var e=this.ctx.canvas.width-30;var r=this.ctx.canvas.height-30;if(barras_mode=="compuesto"){var c=this.data.length;}else{var c=Object.keys(this.data[0]).length;}var l=10;if(c<4){l=l*((1/((c*100)/6)))*100;}var t=(e-(c*l)-20)/c;var y=p;var n=new Kinetic.Layer();var g=0;var v=[];if(!localStorage.ordenacion&&barras_mode=="compuesto"){var u=Object.keys(this.data[0]);var b=0;var s=0;}else{if(!localStorage.ordenacion&&barras_mode=="cols"){var u=Object.keys(this.data[0]);var b=0;var s=0;}else{var u=JSON.parse(localStorage.ordenacion);var b=0;var s=0;}}var k=false;for(var o=0;o<this.data.length;o++){var d="";for(var q=b;q<u.length;q++){switch(barras_mode){case"compuesto":this.drawBarra(y,q,o,r,this.ctx.canvas.height-20-g,n,t,l,u,s,0);if(v.indexOf(q)==-1&&this.printLabels==="true"){if((this.destacado=="true"&&q>1)||(this.destacado!="true"&&q>0)){v.push(q);var a=u[q];var x=this.ctx.measureText(a).width;this.drawLabel(50,this.ctx.canvas.height-40-g,20,"#333","white",a,1,n);}}if(!isNaN(this.data[o][u[q]])){g+=(((this.data[o][u[q]]*100)/(this.ceil))*r/100);}break;case"cols":this.drawBarra(y,q,o,r,this.ctx.canvas.height-20,n,t,l,u,s,q);if(!k){d=u[q];var f=new Kinetic.Text({x:40+(o+q)*(t+l)-(this.ctx.measureText(d).width/2),y:this.ctx.canvas.height-20,fontSize:12,fontFamily:"Mic 32 New Rounded,mic32newrd,Helvetica,Arial",text:d,fill:"black",padding:1});n.add(f);break;}}}k=true;if(barras_mode=="compuesto"){d=this.data[o][Object.keys(this.data[0])[0]];var f=new Kinetic.Text({x:45+(o+0)*(t+l)-(this.ctx.measureText(d).width/2),y:this.ctx.canvas.height-20,fontSize:12,fontFamily:"Mic 32 New Rounded,mic32newrd,Helvetica,Arial",text:d,fill:"black",padding:1});n.add(f);}g=0;}var v=n.find(".label");v.forEach(function(h){h.setZIndex(50);});this.stage.add(n);n.draw();};_.prototype.draw_bars_func=function(k){var f=k.data.destc;var b=[];var e=[];var j=document.querySelectorAll("#groups-ul>li");for(var h=0;h<j[0].children[2].children.length;h++){b.push(new Object);}_().each(j,function(d){var m=j[d].children[1].children[0].innerHTML;e.push(m);_().each(j[d].children[2].children,function(n,i){var o=i[n].children[0].innerHTML;b[n][m]=parseInt(o);});_().each(j[d].children[2].children,function(n,i){var o=i[n].children[0].innerHTML;b[n][m]=o;});});var c=document.querySelectorAll("#fuente_input")[0].value;localStorage.fuente=c;fuente_value=c;var l=document.querySelectorAll("#unidades_input")[0].value;localStorage.unidad=l;unidad_value=l;var g=[];var a=(f=="true")?colores_alpha:colores_barras;_().each(j,function(m){if(m>0||barras_mode=="cols"){if(j[m].children[1].children.length>1){var d={grupo:j[m].children[1].children[0].innerHTML,color:j[m].children[1].children[1].children[0].value};}else{var d={grupo:j[m].children[1].children[0].innerHTML,color:a[(m)%(a.length)].hex};}g.push(d);}var n=e[m];_().each(j[m].children[2].children,function(o,i){var p=parseFloat(i[o].children[0].innerHTML);b[o][n]=p;});});localStorage.coloresBarras=JSON.stringify(g);localStorage.data=JSON.stringify(b);localStorage.ordenacion=JSON.stringify(e);_().saveStep();_("#graph").bars({data:b});};
