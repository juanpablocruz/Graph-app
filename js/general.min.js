var data,tipo;var rABS=typeof FileReader!=="undefined"&&typeof FileReader.prototype!=="undefined"&&typeof FileReader.prototype.readAsBinaryString!=="undefined";window.onerror=function(e,b,d,a,c){console.log(c);switch(c.message){case"Unexpected token u":case"Cannot read property 'color' of undefined":$("#error").css("display","block");$(document).on("click","#error",function(){localStorage.clear();$(this).css("display","none");location.reload();});break;default:location.reload();}};function xlsxworker(c,b){var d=new Worker("js/xlsxworker.min.js");d.onmessage=function(f){switch(f.data.t){case"ready":break;case"e":console.error(f.data.d);break;case"xlsx":b(JSON.parse(f.data.d));break;}};var a=rABS?c:btoa(String.fromCharCode.apply(null,new Uint8Array(c)));d.postMessage({d:a,b:rABS});}function to_json(b){var a={};b.SheetNames.forEach(function(c){var d=XLSX.utils.sheet_to_row_object_array(b.Sheets[c]);if(d.length>0){a[c]=d;}});return a;}var tarea=document.getElementById("b64data");function b64it(){var a=XLSX.read(tarea.value,{type:"base64"});process_wb(a);}function process_wb(b){var a="";a=to_json(b).Hoja1;data=JSON.stringify(a,2,2);localStorage.data=data;tipo=localStorage.chartType;$(".loader").toggle();_("#graph").display_table(b.Sheets);}function handleDrop(h){h.stopPropagation();h.preventDefault();var d=h.dataTransfer.files;var c,g;for(c=0,g=d[c];c!=d.length;++c){var a=new FileReader();var b=g.name;a.onload=function(k){var j=k.target.result;if(typeof Worker!=="undefined"){xlsxworker(j,process_wb);}else{var i;if(rABS){i=XLSX.read(j,{type:"binary"});}else{var f=String.fromCharCode.apply(null,new Uint8Array(j));i=XLSX.read(btoa(f),{type:"base64"});}process_wb(i);}};if(rABS){a.readAsBinaryString(g);}else{a.readAsArrayBuffer(g);}}}function dragevents(){$("#attr-grupos>ul>li").droppable({addClasses:false,accept:".data-list-li",drop:function(f,d){$(this).find("ul").append(d.draggable);}});var c,a,b;$(".sortable-group-list > ul").sortable({start:function(d,e){b=e.item;a=c=e.item.parent();},stop:function(d,e){},change:function(d,e){if(e.sender){a=e.placeholder.parent();}},connectWith:".sortable-group-list > ul",dropOnEmpty:true,forceHelperSize:true,forcePlaceholderSize:true}).disableSelection();}function handleDragover(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";}function cargar(b,a){if(typeof b==="undefined"){localStorage.clear();}else{switch(a){case"Tartas":if(typeof b[0]!="undefined"&&Object.keys(b[0]).indexOf("label")>-1){_("#graph").pie({data:b});$("#save").attr("download","Grafico-tarta");changeStep($(".current_step"),"next");}else{localStorage.removeItem(b);alert("error de archivo");}break;case"Barras":_("#graph").bars({data:b});$("#save").attr("download","Grafico-barras");changeStep($(".current_step"),"next");break;case"Hist√≥ricos":_("#graph").history({data:b});$("#save").attr("download","Grafico-historico");changeStep($(".current_step"),"next");break;}}}function changeStep(b,a){switch(a){case"prev":$(b).removeClass("current_step").prev().first().addClass("current_step");break;case"next":$(b).removeClass("current_step").next().first().addClass("current_step");break;}}$(function(){if(localStorage.data==="undefined"){localStorage.clear();}var d=document.getElementById("b64data");var a=document.getElementById("drop");if(a.addEventListener){a.addEventListener("dragenter",handleDragover,false);a.addEventListener("dragover",handleDragover,false);a.addEventListener("drop",handleDrop,false);}if(localStorage.chartType){if(localStorage.data){changeStep($(".current_step"),"next");changeStep($(".current_step"),"next");}else{$(".step-info ul").html("");var c=$("<li><div class='halfCircleRight'>"+localStorage.chartType+"</div></li>");c.css("z-index",4);$(".step-info ul").append(c);changeStep($(".current_step"),"next");}}_("#tipoGrafico nav ul").menu();if(localStorage.data){if(localStorage.chartType){data=JSON.parse(localStorage.data);tipo=localStorage.chartType;cargar(data,tipo);}}$(document).on("click","#nuevo-graph",function(){$("#output").html("");$(".current_step").removeClass("current_step");$("#tipoGrafico").addClass("current_step");});$(document).on("click",".back",function(){changeStep($(".current_step"),"prev");});$(document).on("click","#tipoGrafico nav ul li",function(){var e=$(this).attr("tipo");$("nav .active").removeClass("active");$(this).addClass("active");localStorage.clear();sessionStorage.clear();$("#controls").html("");localStorage.chartType=e;$(".step-info ul").html("");var f=$("<li><div class='halfCircleRight'>"+e+"</div></li>");f.css("z-index",4);$(".step-info ul").append(f);_("#barstype nav ul").type_menu();changeStep($(this).parent().parent().parent(),"next");});$(document).on("click","#barstype nav ul li",function(){var e=$(this).attr("tipo");$(".step-info ul").html("");var f=$("<li><div class='halfCircleRight'>"+localStorage.chartType+"</div></li>");f.css("z-index",4);$(".step-info ul").append(f);f=$("<li><div class='halfCircleRight'>"+e+"</div></li>");f.css("left","-13px");f.css("z-index","0");$(".step-info ul").append(f);changeStep($(this).parent().parent().parent().parent(),"next");});$(document).on("click","#pie_simple",function(){$(".complex_pie").addClass("simple_pie");$(".active").removeClass("active");$(this).addClass("active");pie_mode="simple";localStorage.pie_mode=pie_mode;});$(document).on("click","#pie_complex",function(){$(".complex_pie").removeClass("simple_pie");$(".active").removeClass("active");$(this).addClass("active");pie_mode="complex";localStorage.pie_mode=pie_mode;});$(document).on("click","#bars_compuesto",function(){$(".complex_pie").removeClass("simple_pie");$(".active").removeClass("active");$(this).addClass("active");barras_mode="compuesto";if(localStorage.coloresBarras){localStorage.removeItem("coloresBarras");}localStorage.barras_mode=barras_mode;});$(document).on("click","#bars_cols",function(){$(".complex_pie").addClass("simple_pie");$(".active").removeClass("active");$(this).addClass("active");barras_mode="cols";if(localStorage.coloresBarras){localStorage.removeItem("coloresBarras");}localStorage.barras_mode=barras_mode;});$(document).on("click","#create-group",function(){var e=$("<li class='sortable-group-list'><span contenteditable='true' class='grupo_tag complex_pie' val='0'>Grupo</span></li>");var f=$("<ul> </ul>");dragevents();e.append(f);$("#attr-grupos>ul").append(e);$(f).sortable({connectWith:".sortable-group-list > ul",dropOnEmpty:true,forceHelperSize:true,forcePlaceholderSize:true}).disableSelection();});$(document).on("click",".rearrange-button",function(){var e=$(".data-list-li-holder").parent();$(".remove-list-item").toggleClass("icon-reorganizar");$(".icon-reorganizar").toggleClass("remove-list-item");$(".data-list-li-holder ").toggleClass("data-list-li");$(".data-list-element-holder").toggleClass("data-list-element");if($(".data-list-element-holder").hasClass("data-list-element")){$(".data-list-element-holder").children().first().attr("contenteditable","false");}else{$(".data-list-element-holder").children().first().attr("contenteditable","true");}});$("#groups-ul").sortable({items:".data-list-li-holder",handle:".data-list-element"});$(document).on("click",".label-dibujar-check",function(){if(!$("#dibujar-check").is(":checked")){localStorage.drawLabels=true;}else{localStorage.drawLabels=false;}});$(document).on("click",".label-dest-check",function(){if(!$("#destacar_check").is(":checked")){localStorage.destacado_bars=true;}else{localStorage.destacado_bars=false;}});$(document).on("mousedown",".data-list-li",function(){$(this).addClass("mousedown");});$(document).on("mouseup",".data-list-li",function(){$(this).removeClass("mousedown");});$(document).on("click",".remove-list-item",function(){$(this).parent().remove();_().saveStep();});$(document).on("click",".label-separador-check",function(){if(!$("#separador-check").is(":checked")){localStorage.separado=true;}else{localStorage.separado=false;}});$(document).on("change","#fileSelect",function(m){var k=($(this)[0].files);var j,l;for(j=0,l=k[j];j!=k.length;++j){var g=new FileReader();var h=l.name;g.onload=function(o){var n=o.target.result;if(typeof Worker!=="undefined"){xlsxworker(n,process_wb);}else{var i;if(rABS){i=XLSX.read(n,{type:"binary"});}else{var f=String.fromCharCode.apply(null,new Uint8Array(n));i=XLSX.read(btoa(f),{type:"base64"});}process_wb(i);}};if(rABS){g.readAsBinaryString(l);}else{g.readAsArrayBuffer(l);}}});dragevents();function b(){colores=standard.slice(0);cargar(data,tipo);}});function undo(){_().undoAction();}
